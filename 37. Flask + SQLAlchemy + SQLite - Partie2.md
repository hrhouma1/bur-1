# <h1 id="cours-flask-sqlalchemy">Cours complet – Créer une API avec Flask + SQLAlchemy + SQLite</h1>

## Objectifs

À la fin de ce cours, vous serez capable de :

* Installer SQLAlchemy et l’utiliser avec Flask
* Créer une base SQLite locale
* Définir des modèles ORM (`Etudiant`, etc.)
* Effectuer des opérations CRUD (Create, Read, Update, Delete) via une API REST



## <h2 id="1-prerequis">1. Prérequis</h2>

* Python 3 installé
* Flask installé (`pip install flask`)
* Terminal prêt (PowerShell, CMD ou Bash)
* Connaissance minimale de Python



## <h2 id="2-creer-projet">2. Créer un projet et activer un environnement</h2>

```bash
mkdir projet_api_sqlalchemy
cd projet_api_sqlalchemy
python -m venv env
.\env\Scripts\activate      # Windows
# ou
source env/bin/activate    # Linux/macOS
```



## <h2 id="3-install-packages">3. Installer les dépendances</h2>

```bash
pip install flask sqlalchemy flask-sqlalchemy
```



## <h2 id="4-structure-projet">4. Structure du projet</h2>

```
projet_api_sqlalchemy/
│
├── env/
├── app.py               ← serveur Flask principal
├── models.py            ← définition de la base de données
└── requirements.txt     ← (optionnel)
```



## <h2 id="5-models-py">5. Créer les modèles ORM (`models.py`)</h2>

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class Etudiant(db.Model):
    __tablename__ = "etudiants"
    id = db.Column(db.Integer, primary_key=True)
    nom = db.Column(db.String(100), nullable=False)
    prenom = db.Column(db.String(100), nullable=False)

    def to_dict(self):
        return {
            "id": self.id,
            "nom": self.nom,
            "prenom": self.prenom
        }
```



## <h2 id="6-app-py">6. Créer le serveur principal (`app.py`)</h2>

```python
from flask import Flask, request, jsonify
from models import db, Etudiant

app = Flask(__name__)

# Configuration de la base SQLite
app.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///etudiants.db"
app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False

# Initialisation de la base
db.init_app(app)

@app.before_first_request
def create_tables():
    db.create_all()
```



## <h2 id="7-ajouter-routes">7. Ajouter les routes API (CRUD)</h2>

### a. Route GET – Tous les étudiants

```python
@app.route("/api/etudiants", methods=["GET"])
def get_etudiants():
    etudiants = Etudiant.query.all()
    return jsonify([e.to_dict() for e in etudiants])
```



### b. Route GET – Étudiant par ID

```python
@app.route("/api/etudiants/<int:id>", methods=["GET"])
def get_etudiant(id):
    etudiant = Etudiant.query.get(id)
    if etudiant:
        return jsonify(etudiant.to_dict())
    return jsonify({"message": "Étudiant introuvable"}), 404
```



### c. Route POST – Ajouter un étudiant

```python
@app.route("/api/etudiants", methods=["POST"])
def ajouter_etudiant():
    data = request.get_json()
    if not data.get("nom") or not data.get("prenom"):
        return jsonify({"message": "Champs requis"}), 400
    nouvel_etudiant = Etudiant(nom=data["nom"], prenom=data["prenom"])
    db.session.add(nouvel_etudiant)
    db.session.commit()
    return jsonify(nouvel_etudiant.to_dict()), 201
```



### d. Route PUT – Modifier un étudiant

```python
@app.route("/api/etudiants/<int:id>", methods=["PUT"])
def modifier_etudiant(id):
    etudiant = Etudiant.query.get(id)
    if not etudiant:
        return jsonify({"message": "Étudiant introuvable"}), 404

    data = request.get_json()
    etudiant.nom = data.get("nom", etudiant.nom)
    etudiant.prenom = data.get("prenom", etudiant.prenom)
    db.session.commit()
    return jsonify(etudiant.to_dict())
```



### e. Route DELETE – Supprimer un étudiant

```python
@app.route("/api/etudiants/<int:id>", methods=["DELETE"])
def supprimer_etudiant(id):
    etudiant = Etudiant.query.get(id)
    if not etudiant:
        return jsonify({"message": "Étudiant introuvable"}), 404
    db.session.delete(etudiant)
    db.session.commit()
    return jsonify({"message": "Étudiant supprimé avec succès"})
```



### f. Lancer le serveur

En bas de `app.py` :

```python
if __name__ == "__main__":
    app.run(debug=True)
```



## <h2 id="8-tester-api">8. Tester l’API avec `curl` ou Postman</h2>

### Exemple POST :

```bash
curl -X POST http://127.0.0.1:5000/api/etudiants \
-H "Content-Type: application/json" \
-d "{\"nom\": \"Tremblay\", \"prenom\": \"Alice\"}"
```

### Exemple GET :

```bash
curl http://127.0.0.1:5000/api/etudiants
```



## <h2 id="9-structure-finale">9. Structure finale du projet</h2>

```
projet_api_sqlalchemy/
│
├── env/
├── app.py               ← routes, configuration serveur
├── models.py            ← classe Etudiant + SQLAlchemy
└── etudiants.db         ← fichier SQLite généré automatiquement
```



## <h2 id="10-extensions">10. Extensions possibles (prochain cours)</h2>

* Ajouter des relations (ex. Etudiant ↔ Programme)
* Ajouter des validations de formulaire
* Ajouter pagination, filtres et tri
* Connecter avec une interface frontend
* Utiliser Flask-Migrate pour gérer les versions de la base


