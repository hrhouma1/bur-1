# <h1 id="intro">Introduction à SQLAlchemy : SQL natif vs ORM - Partie 2</h1>

Ce cours explique simplement comment interagir avec une base de données en Python en comparant deux méthodes :

* **Le SQL natif** : écrire directement du SQL.
* **L’ORM** : utiliser du Python pour interagir avec la base.

On utilisera **SQLAlchemy** comme ORM, et l'interface graphique avec **PySide6** pour simplifier encore plus.

---

# <h1 id="sql-vs-orm">1. SQL natif vs ORM : très simplement</h1>

### Qu’est-ce que le SQL natif ?

Le SQL natif, c’est écrire directement des commandes SQL dans votre code :

Exemple simple de SQL (SQLite) :

```sql
CREATE TABLE etudiants (
    id INTEGER PRIMARY KEY,
    nom TEXT,
    prenom TEXT
);

INSERT INTO etudiants (nom, prenom) VALUES ('Dupont', 'Jean');

SELECT * FROM etudiants;
```

### Qu’est-ce qu’un ORM ?

Un ORM (Object-Relational Mapper), comme SQLAlchemy, permet d’utiliser des classes Python à la place du SQL direct :

Exemple simple avec SQLAlchemy :

```python
etudiant = Etudiant(nom='Dupont', prenom='Jean')
session.add(etudiant)
session.commit()

session.query(Etudiant).all()
```

---

# <h1 id="premiers-pas-sqlalchemy">2. Premiers pas très simples avec SQLAlchemy</h1>

## 2.1 Installation

Installer SQLAlchemy facilement avec pip :

```bash
pip install sqlalchemy
```

---

## 2.2 Créer une première base de données SQLite avec SQLAlchemy

Voici un exemple très simple, étape par étape :

### Étape 1 : Importer SQLAlchemy et créer une base SQLite

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import declarative_base, sessionmaker

engine = create_engine("sqlite:///etudiants.db")
Base = declarative_base()
Session = sessionmaker(bind=engine)
session = Session()
```

### Étape 2 : Définir une classe représentant une table

```python
from sqlalchemy import Column, Integer, String

class Etudiant(Base):
    __tablename__ = "etudiants"
    id = Column(Integer, primary_key=True)
    nom = Column(String)
    prenom = Column(String)
```

### Étape 3 : Créer la table automatiquement

```python
Base.metadata.create_all(engine)
```

---

# <h1 id="operations-simples">3. Opérations très simples avec SQLAlchemy ORM</h1>

## 3.1 Ajouter un étudiant

```python
etudiant = Etudiant(nom="Martin", prenom="Lucie")
session.add(etudiant)
session.commit()
```

## 3.2 Afficher tous les étudiants

```python
etudiants = session.query(Etudiant).all()

for e in etudiants:
    print(e.nom, e.prenom)
```

## 3.3 Modifier un étudiant

```python
etudiant = session.query(Etudiant).filter_by(nom="Martin").first()
etudiant.prenom = "Lucie-Marie"
session.commit()
```

## 3.4 Supprimer un étudiant

```python
etudiant = session.query(Etudiant).filter_by(nom="Martin").first()
session.delete(etudiant)
session.commit()
```

---

# <h1 id="exemple-complet">4. Exemple complet ultra simple avec PySide6 + SQLAlchemy</h1>

## Installation PySide6

```bash
pip install pyside6
```

## Fichier : `database.py`

```python
from sqlalchemy import create_engine, Column, Integer, String
from sqlalchemy.orm import declarative_base, sessionmaker

engine = create_engine("sqlite:///etudiants.db")
Base = declarative_base()
Session = sessionmaker(bind=engine)
session = Session()

class Etudiant(Base):
    __tablename__ = "etudiants"
    id = Column(Integer, primary_key=True)
    nom = Column(String)
    prenom = Column(String)

Base.metadata.create_all(engine)
```

## Fichier : `interface.py`

Interface graphique très simple en PySide6 :

```python
from PySide6.QtWidgets import QApplication, QWidget, QVBoxLayout, QPushButton, QLineEdit, QLabel
import sys
from database import session, Etudiant

class App(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Ajouter un étudiant")
        self.layout = QVBoxLayout()

        self.nom_label = QLabel("Nom :")
        self.nom_input = QLineEdit()
        
        self.prenom_label = QLabel("Prénom :")
        self.prenom_input = QLineEdit()
        
        self.bouton_ajouter = QPushButton("Ajouter")

        self.layout.addWidget(self.nom_label)
        self.layout.addWidget(self.nom_input)
        self.layout.addWidget(self.prenom_label)
        self.layout.addWidget(self.prenom_input)
        self.layout.addWidget(self.bouton_ajouter)

        self.setLayout(self.layout)

        self.bouton_ajouter.clicked.connect(self.ajouter_etudiant)

    def ajouter_etudiant(self):
        nom = self.nom_input.text()
        prenom = self.prenom_input.text()
        etudiant = Etudiant(nom=nom, prenom=prenom)
        session.add(etudiant)
        session.commit()
        print("Étudiant ajouté :", nom, prenom)
        self.nom_input.clear()
        self.prenom_input.clear()

app = QApplication(sys.argv)
fenetre = App()
fenetre.show()
app.exec()
```

Cet exemple permet d'ajouter simplement des étudiants via une interface graphique en utilisant SQLAlchemy en arrière-plan.

---

# <h1 id="exercices-simples">5. Exercices simples à essayer</h1>

### Exercice 1 : Ajouter un champ "email" à la table

* Modifiez le modèle SQLAlchemy pour ajouter un champ "email".
* Modifiez l’interface graphique PySide6 pour saisir l'email.
* Sauvegardez cette nouvelle information dans la base.

### Exercice 2 : Afficher la liste des étudiants dans l'interface PySide6

* Créez un bouton "Afficher les étudiants".
* Lorsque vous cliquez dessus, affichez tous les étudiants dans un simple QLabel ou QTextEdit.

---

# <h1 id="ressources-utiles">6. Ressources utiles pour continuer</h1>

* Documentation officielle SQLAlchemy : [https://docs.sqlalchemy.org](https://docs.sqlalchemy.org)
* Documentation officielle PySide6 : [https://doc.qt.io/qtforpython-6/](https://doc.qt.io/qtforpython-6/)

---

# <h1 id="conclusion">7. Conclusion simple</h1>

Vous venez de découvrir comment passer facilement du SQL natif vers l'utilisation d'un ORM comme SQLAlchemy en Python, et comment intégrer une interface graphique très simple avec PySide6. Ces outils permettent de construire rapidement des applications simples et professionnelles.

