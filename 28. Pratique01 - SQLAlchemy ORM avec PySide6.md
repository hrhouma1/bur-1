# <h1 id="intro-sqlalchemy"> Pratique 01 SQLAlchemy ORM avec PySide6</h1>

## Objectifs du cours :

À la fin de ce tutoriel très détaillé, vous serez capable de :

* Différencier clairement SQL natif et ORM.
* Installer et configurer SQLAlchemy dans un projet Python.
* Créer une base de données simple avec SQLAlchemy.
* Connecter une interface PySide6 à SQLAlchemy pour ajouter et lire des données.

## Prérequis (très importants) :

* Windows 10 ou 11 installé.
* Python installé (version recommandée : 3.10 ou 3.11).
* Un terminal (CMD ou PowerShell).
* Aucune connaissance préalable requise.


# Étape 1 — Créer le dossier du projet

* Ouvrez votre explorateur de fichiers Windows.
* Créez un dossier clairement nommé, par exemple :

```
C:\Users\votre_nom\Desktop\projet_sqlalchemy
```

* Dans votre terminal (CMD), naviguez dans ce dossier :

```bash
cd C:\Users\votre_nom\Desktop\projet_sqlalchemy
```



# Étape 2 — Créer un environnement virtuel (important)

Un environnement virtuel permet d’isoler vos dépendances Python :

Tapez précisément ces commandes :

```bash
python -m venv env
.\env\Scripts\activate
```

Vous devez voir maintenant `(env)` à gauche dans votre terminal. Cela signifie que l'environnement virtuel est activé.



# Étape 3 — Installer SQLAlchemy et PySide6

Dans votre terminal, tapez :

```bash
pip install sqlalchemy pyside6
```

Vérifiez que l'installation s’est bien déroulée en tapant :

```bash
pip show sqlalchemy
pip show pyside6
```

Vous devez voir s'afficher des détails (nom, version, etc.).



# Étape 4 — Vérifier que Qt Designer est bien installé

Pour vérifier facilement, tapez exactement :

```bash
pyside6-designer
```

Qt Designer doit s’ouvrir automatiquement. Si c’est le cas, fermez-le maintenant.



# Étape 5 — Créer une interface graphique très simple avec Qt Designer

* Lancez Qt Designer :

```bash
pyside6-designer
```

* Choisissez **Main Window** puis cliquez sur **Create**.
* Dans la fenêtre ouverte :

  * Faites glisser un bouton (`QPushButton`) et un label (`QLabel`) dans la fenêtre principale.
* Cliquez une fois sur le bouton et nommez-le exactement `pushButtonAjouter`.
* Cliquez une fois sur le label et nommez-le exactement `labelResultat`.
* Enregistrez le fichier avec le nom exact : `interface.ui` dans le dossier du projet.

Fermez Qt Designer après cette sauvegarde.



# Étape 6 — Convertir le fichier `.ui` en fichier Python (`interface.py`)

* Dans votre terminal, tapez exactement :

```bash
pyside6-uic interface.ui -o interface.py
```

Un nouveau fichier nommé `interface.py` est créé automatiquement. Ne le modifiez jamais manuellement !



# Étape 7 — Créer une base de données SQLite avec SQLAlchemy

Créez un nouveau fichier nommé exactement : `database.py`

Écrivez précisément ces lignes (sans modifications) :

```python
from sqlalchemy import create_engine, Column, Integer, String
from sqlalchemy.orm import declarative_base, sessionmaker

engine = create_engine("sqlite:///etudiants.db", echo=True)
Base = declarative_base()
Session = sessionmaker(bind=engine)
session = Session()

class Etudiant(Base):
    __tablename__ = "etudiants"
    id = Column(Integer, primary_key=True)
    nom = Column(String)
    prenom = Column(String)

Base.metadata.create_all(engine)
```

Enregistrez ce fichier sans erreurs.



# Étape 8 — Connecter PySide6 avec SQLAlchemy (fichier `main.py` très détaillé)

Créez un fichier nommé exactement : `main.py`

Écrivez précisément le code suivant sans modifications (copiez soigneusement) :

```python
import sys
from PySide6.QtWidgets import QApplication, QMainWindow
from interface import Ui_MainWindow
from database import session, Etudiant

class Application(QMainWindow):
    def __init__(self):
        super().__init__()
        self.ui = Ui_MainWindow()
        self.ui.setupUi(self)

        # Connecter le clic du bouton à la fonction ajouter_etudiant
        self.ui.pushButtonAjouter.clicked.connect(self.ajouter_etudiant)

    def ajouter_etudiant(self):
        # Créer un nouvel étudiant (exemple simple fixe)
        nouvel_etudiant = Etudiant(nom="Dupont", prenom="Jean")

        # Ajouter à la session (mémoire temporaire)
        session.add(nouvel_etudiant)

        # Sauvegarder définitivement dans la base de données
        session.commit()

        # Afficher un message de succès
        self.ui.labelResultat.setText("Étudiant ajouté : Dupont Jean")

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = Application()
    window.show()
    sys.exit(app.exec())
```



# Étape 9 — Lancer votre application graphique complète (très détaillé)

* Vérifiez que votre environnement virtuel est toujours actif :

```bash
.\env\Scripts\activate
```

* Tapez ensuite exactement cette commande :

```bash
python main.py
```

Votre application graphique doit s’ouvrir.

* Cliquez sur le bouton. Vous verrez s’afficher :

```
Étudiant ajouté : Dupont Jean
```



# Structure finale détaillée du projet :

À la fin, votre projet doit contenir exactement ces fichiers :

```
projet_sqlalchemy/
│
├── env/                  (ne pas modifier)
├── interface.ui          (créé par Qt Designer)
├── interface.py          (créé automatiquement par pyside6-uic)
├── database.py           (code SQLAlchemy, créé manuellement)
└── main.py               (code PySide6+SQLAlchemy, créé manuellement)
```



# Bonnes pratiques très importantes à retenir :

* Ne jamais modifier `interface.py`. Utilisez toujours Qt Designer.
* Vérifiez bien l’activation de l’environnement virtuel à chaque fois :

```bash
.\env\Scripts\activate
```

* Créez toujours les fichiers et dossiers avec les noms exacts donnés.
* Copiez soigneusement le code proposé sans modifications, sauf indication contraire.



# Aller plus loin (étapes futures détaillées) :

* Essayez d'ajouter des champs supplémentaires (`email`, `age`) dans Qt Designer et dans SQLAlchemy.
* Essayez de modifier l’application pour entrer le nom et prénom via des champs `QLineEdit` plutôt que des valeurs fixes.
* Ajoutez un bouton pour afficher tous les étudiants existants dans la base.



# Annexe utile : Localiser `designer.exe` (si besoin)

* Tapez dans votre terminal :

```bash
pip show pyside6
```

* Trouvez la ligne qui commence par `Location:`
* Allez dans ce dossier puis naviguez précisément vers :

```
qt6_applications\Qt\bin\
```

Vous trouverez `designer.exe` à cet endroit précis.



## Résumé final très détaillé :

Ce tutoriel très détaillé vous permet d’apprendre pas à pas comment :

1. Installer proprement SQLAlchemy et PySide6.
2. Créer une interface graphique simple avec Qt Designer.
3. Connecter simplement PySide6 avec une base de données via SQLAlchemy.
4. Manipuler facilement des données avec une interface graphique simple.


<br/>
<br/>

# Annexe 1 - interface.py (interface manuelle sans `.ui`)

Créez ce fichier à la main :

```python
from PySide6.QtWidgets import QMainWindow, QPushButton, QLabel

class Ui_MainWindow:
    def setupUi(self, MainWindow):
        MainWindow.setWindowTitle("SQLAlchemy + PySide6")

        # Taille de la fenêtre
        MainWindow.resize(400, 200)

        # Bouton Ajouter
        self.pushButtonAjouter = QPushButton(MainWindow)
        self.pushButtonAjouter.setText("Ajouter un étudiant")
        self.pushButtonAjouter.setGeometry(100, 40, 200, 40)

        # Label Résultat
        self.labelResultat = QLabel(MainWindow)
        self.labelResultat.setText("")
        self.labelResultat.setGeometry(100, 100, 200, 40)
        self.labelResultat.setWordWrap(True)
```



## Rappel du contenu de `main.py` (inchangé)

```python
import sys
from PySide6.QtWidgets import QApplication, QMainWindow
from interface import Ui_MainWindow
from database import session, Etudiant

class Application(QMainWindow):
    def __init__(self):
        super().__init__()
        self.ui = Ui_MainWindow()
        self.ui.setupUi(self)

        # Connecter le bouton à la méthode
        self.ui.pushButtonAjouter.clicked.connect(self.ajouter_etudiant)

    def ajouter_etudiant(self):
        nouvel_etudiant = Etudiant(nom="Dupont", prenom="Jean")
        session.add(nouvel_etudiant)
        session.commit()
        self.ui.labelResultat.setText("Étudiant ajouté : Dupont Jean")

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = Application()
    window.show()
    sys.exit(app.exec())
```



## Arborescence du projet

```
projet_sqlalchemy/
│
├── env/                  (ne pas modifier)
├── interface.py          (écrit manuellement)
├── database.py           (modèle SQLAlchemy)
└── main.py               (application graphique)
```





<br/>
<br/>

# Annexe 2 - Voir les données

## **Option 1 — Utiliser la ligne de commande avec `sqlite3` (méthode directe)**


- Téléchargement manuel

1. Allez sur : [https://www.sqlite.org/download.html](https://www.sqlite.org/download.html)
2. Téléchargez **sqlite-tools-win32-x86-...zip**
3. Extrayez le dossier, copiez l’exécutable `sqlite3.exe` dans un dossier, par exemple :

```
C:\sqlite\
```

4. Ajoutez ce dossier au **PATH** :

   * Démarrer → taper "variables d’environnement"
   * Modifier la variable `Path`
   * Ajouter : `C:\sqlite\`

Ensuite, ouvrir de nouveau PowerShell :

```powershell
sqlite3 etudiants.db
```

1. **Ouvrez votre terminal**.
2. Naviguez dans le dossier où se trouve la base `etudiants.db` :

```bash
cd C:\Users\votre_nom\Desktop\projet_sqlalchemy
```

3. **Lancez SQLite** :

```bash
sqlite3 etudiants.db
```

4. Une fois dans le shell SQLite, tapez :

```sql
.tables
```

Cela devrait afficher :

```
etudiants
```

5. Pour afficher tous les étudiants :

```sql
SELECT * FROM etudiants;
```

6. Pour quitter :

```sql
.exit
```



## **Option 2 — Ajouter un bouton dans l'application PySide6 pour les afficher**

Vous pouvez ajouter un bouton `Afficher` dans `interface.py` et une méthode dans `main.py`. 


## **Option 3 — Utiliser un outil graphique comme DB Browser for SQLite**

1. Téléchargez : [https://sqlitebrowser.org](https://sqlitebrowser.org)
2. Ouvrez le fichier `etudiants.db`.
3. Allez dans l’onglet "Browse Data".
4. Sélectionnez la table `etudiants`.


## Option 4 - Script python


Puisque vous avez déjà Python installé, vous pouvez **inspecter la base SQLite sans installer `sqlite3.exe`** en exécutant ce script Python :

### Créez un fichier `inspect_db.py` avec ce contenu :

```python
import sqlite3

# Connexion à la base
conn = sqlite3.connect("etudiants.db")
cursor = conn.cursor()

# Affiche les tables existantes
print("Tables disponibles :")
cursor.execute("SELECT name FROM sqlite_master WHERE type='table';")
print(cursor.fetchall())

# Affiche le contenu de la table "etudiants"
print("\nContenu de la table 'etudiants' :")
cursor.execute("SELECT * FROM etudiants;")
for row in cursor.fetchall():
    print(row)

conn.close()
```

### Puis exécutez :

```bash
python inspect_db.py
```





