<h1 id="examen-api-python">DÃ©mo 2 â€“ Consommation dâ€™APIs publiques avec Python</h1>

<h2 id="contexte">Contexte</h2>

Vous Ãªtes chargÃ© de crÃ©er un petit outil dâ€™exploration dâ€™APIs ouvertes. Toutes les APIs sont publiques et accessibles en lecture seule. Vous utiliserez exclusivement la mÃ©thode HTTP `GET`. Lâ€™examen vise Ã  valider les compÃ©tences suivantes :

* Savoir faire une requÃªte GET avec `requests`
* Analyser une rÃ©ponse JSON
* Afficher les donnÃ©es utiles avec une mise en forme propre
* GÃ©rer les erreurs de rÃ©ponse
* Utiliser une API externe sans authentification (ou avec clÃ© publique si fournie)

---

<h2 id="instructions-generales">Instructions gÃ©nÃ©rales</h2>

* Utilisez le module `requests` pour faire vos appels API.
* Affichez uniquement les donnÃ©es demandÃ©es (pas la rÃ©ponse complÃ¨te).
* GÃ©rez les cas dâ€™erreur (codes autres que 200, absence de clÃ©, etc.).
* Utilisez `json.dumps(..., indent=2)` si nÃ©cessaire pour lâ€™affichage.


---

<h2 id="partie-1-etude-api">Partie 1 â€“ Ã‰tude d'une API de donnÃ©es publiques</h2>

### Question 1 â€“ Affichage des Ã©tablissements publics du dÃ©partement 53

Utilisez lâ€™API suivante :
ğŸ‘‰ `https://etablissements-publics.api.gouv.fr/v3/departements/53/cci`

**Travail demandÃ© :**

* Faites une requÃªte `GET`
* Affichez pour chaque Ã©tablissement :

  * Le nom (`nom`)
  * L'adresse (`adresse`)
  * La ville (`ville`)
  * Le code postal (`codePostal`)

**Bonus :** Affichez le nombre total dâ€™Ã©tablissements.


---

<h2 id="partie-2-analyse-et-filtrage">Partie 2 â€“ Analyse et filtrage de donnÃ©es</h2>

### Question 2 â€“ Liste des pays par continent (Europe uniquement)

Utilisez lâ€™API RestCountries v3 :
ğŸ‘‰ `https://restcountries.com/v3.1/all`

**Travail demandÃ© :**

* Filtrer les pays du continent Europe
* Pour chacun, afficher :

  * Nom du pays
  * Capitale
  * Population


---

<h2 id="partie-3-integration-avec-une-api-fictive">Partie 3 â€“ Simulation de forum</h2>

### Question 3 â€“ Liste des commentaires du post numÃ©ro 1

ğŸ‘‰ `https://jsonplaceholder.typicode.com/comments?postId=1`

**Travail demandÃ© :**

* Affichez :

  * Lâ€™auteur du commentaire (`name`)
  * Son courriel (`email`)
  * Le contenu (`body`)
* Affichez le nombre total de commentaires reÃ§us

---

<h2 id="partie-4-api-citation">Partie 4 â€“ API de citation</h2>

### Question 4 â€“ Affichage dâ€™une citation courte alÃ©atoire

ğŸ‘‰ `https://api.quotable.io/random?maxLength=20`

**Travail demandÃ© :**

* Affichez la citation et son auteur
* Relancer cette requÃªte 3 fois

---

<h2 id="partie-5-api-meteo">Partie 5 â€“ API mÃ©tÃ©o (simulation)</h2>

### Question 5 â€“ Obtenir la mÃ©tÃ©o actuelle Ã  MontrÃ©al

ğŸ‘‰ `http://api.openweathermap.org/data/2.5/weather?q=Montreal&appid=YOUR_API_KEY&units=metric`

**Travail demandÃ© :**

* Affichez :

  * TempÃ©rature (`main.temp`)
  * Description mÃ©tÃ©o (`weather[0].description`)
  * Vitesse du vent (`wind.speed`)

**Remarque :** remplacez `YOUR_API_KEY` par une clÃ© valide si vous en avez une. Sinon, commentez la partie.

---

<h2 id="partie-6-api-crypto">Partie 6 â€“ Prix du Bitcoin</h2>

### Question 6 â€“ Affichage du prix du Bitcoin en dollars canadiens

ğŸ‘‰ `https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=cad`

**Travail demandÃ© :**

* Affichez le prix actuel du Bitcoin en CAD



---

<h2 id="partie-7-analyse">Partie 7 â€“ Mini-analyse</h2>

### Question 7 â€“ Comparaison de deux APIs

Choisissez **deux** des APIs utilisÃ©es plus haut et rÃ©pondez :

* Quelle API est la plus facile Ã  utiliser et pourquoi ?
* Laquelle a la structure de donnÃ©es la plus complexe ?
* Y avait-il des erreurs ou des piÃ¨ges particuliers ?

---

<h2 id="livrables">Livrables</h2>

* Un fichier `.py` contenant votre code bien commentÃ©
* Un fichier `README.md` avec :

  * Le nom des APIs utilisÃ©es
  * Une capture dâ€™Ã©cran ou exemple de sortie
  * Vos rÃ©ponses Ã  la question 7 (analyse)



<br/>

<br/>


# Correction des exercices


## <h2 id="corr-exo1">Correction â€“ Exercice 1 : Analyse dâ€™un prÃ©nom (API agify, genderize, nationalize)</h2>

### Objectif

Faire appel Ã  trois APIs publiques pour obtenir des informations liÃ©es Ã  un prÃ©nom fourni par lâ€™utilisateur.



### ğŸ”§ Script `exo1.py`

```python
import requests

def get_age(name):
    url = f"https://api.agify.io/?name={name}"
    response = requests.get(url)
    return response.json()

def get_gender(name):
    url = f"https://api.genderize.io/?name={name}"
    response = requests.get(url)
    return response.json()

def get_nationalities(name):
    url = f"https://api.nationalize.io/?name={name}"
    response = requests.get(url)
    return response.json()

def afficher_resultats(name):
    try:
        age_data = get_age(name)
        gender_data = get_gender(name)
        nat_data = get_nationalities(name)

        print(f"\nPrÃ©nom : {name.capitalize()}")
        print(f"Ã‚ge estimÃ© : {age_data.get('age', 'inconnu')} ans")
        print(f"Genre : {gender_data.get('gender', 'inconnu')} (probabilitÃ© : {gender_data.get('probability', 0):.2f})")

        print("NationalitÃ©s probables :")
        for country in nat_data.get('country', []):
            print(f" - {country['country_id']} ({country['probability']:.2f})")

    except Exception as e:
        print("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es :", e)

if __name__ == "__main__":
    nom = input("Entrez un prÃ©nom : ").strip().lower()
    afficher_resultats(nom)
```



###  Explications 

* **Trois fonctions dÃ©diÃ©es** Ã  chaque API â†’ bonne sÃ©paration des responsabilitÃ©s.
* Utilisation de `.get()` pour Ã©viter les erreurs si une clÃ© est absente.
* Affichage structurÃ© des donnÃ©es : propre et lisible.
* Traitement des exceptions global pour Ã©viter les crashs.



---



## <h2 id="corr-exo2">Correction â€“ Exercice 2 : UniversitÃ©s dans un pays donnÃ©</h2>

### Objectif

Consommer lâ€™API `https://universities.hipolabs.com/search?country=XXX` pour lister les universitÃ©s dâ€™un pays.

---

### ğŸ”§ Script `exo2.py`

```python
import requests

def get_universites(pays):
    url = f"https://universities.hipolabs.com/search?country={pays}"
    response = requests.get(url)
    response.raise_for_status()  # GÃ©nÃ¨re une erreur si le code HTTP est 4xx ou 5xx
    return response.json()

def afficher_universites(liste_univ):
    total = len(liste_univ)
    print(f"\nNombre total d'universitÃ©s trouvÃ©es : {total}\n")
    
    for i, univ in enumerate(liste_univ[:10], 1):  # Afficher seulement les 10 premiÃ¨res
        print(f"{i}. {univ.get('name')}")

if __name__ == "__main__":
    pays = input("Entrez le nom dâ€™un pays (en anglais, ex: Canada) : ").strip()
    
    try:
        universites = get_universites(pays)
        if universites:
            afficher_universites(universites)
        else:
            print("Aucune universitÃ© trouvÃ©e pour ce pays.")
    except requests.exceptions.HTTPError as errh:
        print("Erreur HTTP :", errh)
    except requests.exceptions.RequestException as err:
        print("Erreur de connexion :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```



### Explications 

* `raise_for_status()` est utilisÃ©e pour intercepter les erreurs HTTP proprement.
* Affichage limitÃ© Ã  10 universitÃ©s pour garder la sortie lisible.
* Le script est robuste, gÃ¨re les erreurs rÃ©seau et les entrÃ©es incorrectes.
* Utilisation de `.get()` pour Ã©viter les `KeyError`.



----




## <h2 id="corr-exo3">Correction â€“ Exercice 3 : Blague et image dâ€™animal</h2>

### Objectif

1. Afficher une blague de Chuck Norris (API `chucknorris.io`)
2. TÃ©lÃ©charger et afficher une image alÃ©atoire de chien (API `dog.ceo`)

---

### ğŸ”§ Script `exo3.py`

```python
import requests
from PIL import Image
from io import BytesIO

def get_blague():
    url = "https://api.chucknorris.io/jokes/random"
    response = requests.get(url)
    return response.json().get("value")

def get_image_url():
    url = "https://dog.ceo/api/breeds/image/random"
    response = requests.get(url)
    data = response.json()
    return data.get("message")  # URL de l'image

def afficher_image_depuis_url(image_url):
    try:
        reponse_image = requests.get(image_url)
        image = Image.open(BytesIO(reponse_image.content))
        image.show()
    except Exception as e:
        print("Erreur lors de l'affichage de l'image :", e)

if __name__ == "__main__":
    try:
        print("\nBlague du jour :")
        print(get_blague())

        print("\nTÃ©lÃ©chargement de lâ€™image de chien...")
        url_image = get_image_url()
        print("Image URL :", url_image)

        afficher_image_depuis_url(url_image)

    except requests.exceptions.RequestException as err:
        print("Erreur de connexion :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```



### Explications 

* `PIL` et `BytesIO` sont utilisÃ©s pour **afficher lâ€™image depuis une URL sans sauvegarde locale**.
* Lâ€™image est ouverte directement en mÃ©moire grÃ¢ce Ã  `BytesIO`.
* La fonction `image.show()` lance la visionneuse dâ€™images du systÃ¨me (si installÃ©e).
* Chaque Ã©tape est bien sÃ©parÃ©e (blague, rÃ©cupÃ©ration dâ€™image, affichage).

---

### Remarque importante

Ce script nÃ©cessite la **bibliothÃ¨que PIL** (ou `Pillow`) :
Ã€ installer avec :

```bash
pip install pillow
```



---




## <h2 id="corr-exo4">Correction â€“ Exercice 4 : Faits divers sur les chats</h2>

### Objectif

* Appeler 5 fois lâ€™API `https://catfact.ninja/fact`
* Afficher les faits reÃ§us
* Bonus : les enregistrer dans un fichier texte



### ğŸ”§ Script `exo4.py`

```python
import requests

def get_cat_fact():
    url = "https://catfact.ninja/fact"
    response = requests.get(url)
    data = response.json()
    return data.get("fact")

def enregistrer_faits(faits, nom_fichier="faits_chats.txt"):
    try:
        with open(nom_fichier, "w", encoding="utf-8") as f:
            for i, fait in enumerate(faits, 1):
                f.write(f"{i}. {fait}\n")
        print(f"\nFaits enregistrÃ©s dans le fichier : {nom_fichier}")
    except Exception as e:
        print("Erreur lors de l'enregistrement du fichier :", e)

if __name__ == "__main__":
    faits = []
    try:
        print("Faits amusants sur les chats :\n")
        for i in range(5):
            fait = get_cat_fact()
            print(f"{i+1}. {fait}")
            faits.append(fait)

        enregistrer_faits(faits)

    except requests.exceptions.RequestException as err:
        print("Erreur de connexion :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```



###  Explications

* Une boucle `for` permet de faire 5 appels successifs Ã  lâ€™API.
* Utilisation dâ€™une **liste `faits`** pour stocker les rÃ©ponses et les sauvegarder.
* Le fichier texte est Ã©crit avec encodage `utf-8` pour supporter les caractÃ¨res spÃ©ciaux.
* Le script est robuste aux erreurs (rÃ©seau, fichier, etc.).


---




## <h2 id="corr-exo5">Correction â€“ Exercice 5 : Recherche dans les APIs publiques (catÃ©gorie Animals)</h2>

### Objectif

* Appeler lâ€™API `https://api.publicapis.org/entries`
* Filtrer les rÃ©sultats par catÃ©gorie (ex. : `"Animals"`)
* Afficher nom, description et lien des APIs trouvÃ©es

---

### ğŸ”§ Script `exo5.py`

```python
import requests

def get_apis():
    url = "https://api.publicapis.org/entries"
    response = requests.get(url)
    response.raise_for_status()
    return response.json().get("entries", [])

def filtrer_par_categorie(entries, categorie="Animals"):
    return [api for api in entries if api.get("Category") == categorie]

def afficher_apis(apis):
    if not apis:
        print("Aucune API trouvÃ©e dans cette catÃ©gorie.")
    for i, api in enumerate(apis, 1):
        print(f"\n{i}. Nom       : {api.get('API')}")
        print(f"   Description : {api.get('Description')}")
        print(f"   Lien        : {api.get('Link')}")

if __name__ == "__main__":
    try:
        print("RÃ©cupÃ©ration des APIs publiques...")
        toutes_les_apis = get_apis()
        apis_animaux = filtrer_par_categorie(toutes_les_apis, "Animals")
        afficher_apis(apis_animaux)

    except requests.exceptions.RequestException as err:
        print("Erreur de connexion :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```



### Explications

* Lâ€™ensemble des rÃ©sultats est obtenu via la clÃ© `"entries"` dans la rÃ©ponse JSON.
* Une **liste par comprÃ©hension** filtre directement les APIs de la catÃ©gorie `"Animals"`.
* Les champs `API`, `Description` et `Link` sont extraits un par un avec `.get()` pour Ã©viter les erreurs.
* Le script affiche proprement les rÃ©sultats.



---



## <h2 id="corr-exo6">Correction â€“ Exercice 6 : Analyse dâ€™un pays (API restcountries)</h2>

### Objectif

* Utiliser `https://restcountries.com/v3.1/all`
* Demander un nom de pays Ã  lâ€™utilisateur
* Afficher : nom, capitale, population, langues, devise, drapeau (URL)

---

### ğŸ”§ Script `exo6.py`

```python
import requests

def get_all_countries():
    url = "https://restcountries.com/v3.1/all"
    response = requests.get(url)
    response.raise_for_status()
    return response.json()

def chercher_pays(nom_pays, liste_pays):
    for pays in liste_pays:
        noms = pays.get("name", {}).get("common", "").lower()
        if nom_pays.lower() == noms:
            return pays
    return None

def afficher_infos(pays):
    nom = pays.get("name", {}).get("common", "N/A")
    capitale = pays.get("capital", ["N/A"])[0]
    population = pays.get("population", 0)
    langues = ", ".join(pays.get("languages", {}).values())
    devises = ", ".join(pays.get("currencies", {}).keys())
    drapeau = pays.get("flags", {}).get("png", "N/A")

    print(f"\nNom : {nom}")
    print(f"Capitale : {capitale}")
    print(f"Population : {population:,}")
    print(f"Langues officielles : {langues}")
    print(f"Devise(s) : {devises}")
    print(f"Drapeau (image) : {drapeau}")

if __name__ == "__main__":
    try:
        nom_recherche = input("Entrez le nom du pays (en anglais, ex: France) : ").strip()
        liste = get_all_countries()
        pays = chercher_pays(nom_recherche, liste)

        if pays:
            afficher_infos(pays)
        else:
            print("Pays non trouvÃ© dans la base.")

    except requests.exceptions.RequestException as err:
        print("Erreur rÃ©seau :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```



###  Explications pÃ©dagogiques

* `restcountries.com` retourne une **liste de dictionnaires**, chaque dictionnaire reprÃ©sentant un pays.
* Le champ `"languages"` est un dictionnaire â†’ il faut `values()` pour les noms.
* Le champ `"currencies"` est aussi un dictionnaire â†’ on rÃ©cupÃ¨re les clÃ©s (EUR, USDâ€¦).
* Les drapeaux sont accessibles via `"flags"` â†’ on peut utiliser `"png"` pour afficher dans un navigateur si besoin.



----


## <h2 id="corr-exo7">Correction â€“ Exercice 7 : Ã‰tablissements publics dâ€™un dÃ©partement</h2>

### Objectif

* Utiliser lâ€™API officielle franÃ§aise :
  `https://etablissements-publics.api.gouv.fr/v3/departements/{dep}/communes`
* Afficher les communes et les services publics qui y sont prÃ©sents.

---

### ğŸ”§ Script `exo7.py`

```python
import requests

def get_communes_et_services(departement):
    url = f"https://etablissements-publics.api.gouv.fr/v3/departements/{departement}/communes"
    response = requests.get(url)
    response.raise_for_status()
    return response.json()  # Liste de communes

def afficher_communes(data):
    if not data:
        print("Aucune commune trouvÃ©e.")
        return

    for commune in data:
        nom_commune = commune.get("nom", "Inconnu")
        print(f"\nCommune : {nom_commune}")

        services = commune.get("services", [])
        if not services:
            print("  Aucun service public trouvÃ©.")
        else:
            for service in services:
                print(f"  - {service.get('nom', 'Service inconnu')}")

if __name__ == "__main__":
    departement = input("Entrez un numÃ©ro de dÃ©partement (ex: 75 pour Paris) : ").strip()

    try:
        communes = get_communes_et_services(departement)
        afficher_communes(communes)

    except requests.exceptions.HTTPError as errh:
        print("Erreur HTTP :", errh)
    except requests.exceptions.RequestException as err:
        print("Erreur rÃ©seau :", err)
    except Exception as e:
        print("Erreur inattendue :", e)
```

---

###  Explications 

* La rÃ©ponse est une **liste de communes**, chaque commune contient une **liste de services**.
* Lâ€™affichage est bien structurÃ© : commune + services associÃ©s.
* Le script est entiÃ¨rement protÃ©gÃ© contre les erreurs (rÃ©seau, HTTP, structure manquante).
* On utilise `.get()` systÃ©matiquement pour Ã©viter tout plantage si une clÃ© est absente.




